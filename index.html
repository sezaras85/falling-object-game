<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Falling Object Catch Game</title>
  <style>
    /* Your existing CSS styles remain unchanged */
  </style>
</head>
<body>
  <h1>Falling Object Catch Game</h1>
  <h3>Score: <span id="score">0</span></h3>
  <canvas id="gameCanvas" width="800" height="600"></canvas>

  <!-- Start Screen -->
  <div id="startScreen">
    <h2>Welcome to the Falling Object Catch Game</h2>
    <button onclick="startGame()">Start Game</button>
    <div id="howToPlay">
      <p><strong>How to Play:</strong></p>
      <p>Use arrow keys to move the box and catch the falling objects.</p>
    </div>
  </div>

  <!-- Game Over Screen -->
  <div id="gameOverScreen">
    <h2>Game Over</h2>
    <p>Your Score: <span id="finalScore"></span></p>
    <button onclick="restartGame()">Restart</button>
    <button class="confirmScore" onclick="confirmScore()">SP1-Confirm Score</button>
  </div>

  <!-- Loading Screen -->
  <div id="loadingScreen">
    <p>Confirming your score...</p>
    <div class="progress-bar">
      <div class="progress"></div>
    </div>
    <p id="loadingText">0%</p>
  </div>

  <!-- Include WASM Module -->
  <script type="module">
    import init from './static/pkg/wasm_module.js';

    // Initialize the WASM module
    init().then(() => {
      console.log('WASM module loaded successfully!');
      // Once WASM is loaded, you can integrate it into your game logic
    }).catch(err => {
      console.error('Failed to load WASM module:', err);
    });
  </script>

  <!-- Your Game Logic and JavaScript -->
  <script>
    const canvas = document.getElementById('gameCanvas');
    const ctx = canvas.getContext('2d');
    const playerImg = new Image();
    playerImg.src = "kutu.png"; // Box image

    const crabImg = new Image();
    crabImg.src = "yengec.png"; // Crab image

    let score = 0;
    let objects = [];
    let player = {
      x: canvas.width / 2 - 45,
      y: 470,
      width: 90,
      height: 40,
      speed: 15
    };

    let gameOver = false;

    // Create falling object (crab)
    function createObject() {
      const size = 30;
      const x = Math.random() * (canvas.width - size);
      const y = -size;
      const obj = { x, y, size, speed: 2 };
      objects.push(obj);
    }

    // Draw falling objects (crab)
    function drawObjects() {
      objects.forEach(obj => {
        ctx.drawImage(crabImg, obj.x, obj.y, obj.size, obj.size);
      });
    }

    // Check for collision with the box
    function checkCollision() {
      objects.forEach((obj, index) => {
        if (obj.x < player.x + player.width &&
            obj.x + obj.size > player.x &&
            obj.y < player.y + player.height &&
            obj.y + obj.size > player.y) {
          objects.splice(index, 1);  // Remove object
          score++;  // Increase score
          document.getElementById("score").innerText = score;
        }
      });
    }

    // Move the box
    function movePlayer() {
      if (keys.right && player.x + player.width < canvas.width) {
        player.x += player.speed;
      }
      if (keys.left && player.x > 0) {
        player.x -= player.speed;
      }
    }

    // Keyboard controls
    const keys = { right: false, left: false };
    window.addEventListener('keydown', function(e) {
      if (e.key === 'ArrowRight') keys.right = true;
      if (e.key === 'ArrowLeft') keys.left = true;
    });
    window.addEventListener('keyup', function(e) {
      if (e.key === 'ArrowRight') keys.right = false;
      if (e.key === 'ArrowLeft') keys.left = false;
    });

    // Draw the box
    function drawPlayer() {
      ctx.drawImage(playerImg, player.x, player.y, player.width, player.height);
    }

    // Game loop
    function gameLoop() {
      if (gameOver) return;

      ctx.clearRect(0, 0, canvas.width, canvas.height);  // Clear canvas
      drawObjects();
      drawPlayer();  // Draw box
      movePlayer();
      checkCollision();

      objects.forEach(obj => {
        obj.y += obj.speed;

        // End game if an object falls off screen
        if (obj.y > canvas.height) {
          gameOver = true;
          displayGameOver();
        }
      });

      requestAnimationFrame(gameLoop);
    }

    // Show the game over screen
    function displayGameOver() {
      document.getElementById("gameOverScreen").style.display = 'block';
      document.getElementById("finalScore").innerText = score;
    }

    // Restart the game
    function restartGame() {
      score = 0;
      objects = [];
      player.x = canvas.width / 2 - 45;
      player.y = 470;
      gameOver = false;
      document.getElementById("gameOverScreen").style.display = 'none';
      gameLoop();
    }

    // Start the game
    function startGame() {
      document.getElementById("startScreen").style.display = 'none';
      gameLoop(); // Start the game loop
      setInterval(createObject, 1000); // Create objects every second
    }

    // Confirm score and validate via SP1 (Simulated)
    function confirmScore() {
      document.getElementById("loadingScreen").style.display = 'block'; // Show loading screen
      let progress = 0;
      let interval = setInterval(() => {
        progress += 10;
        document.querySelector('.progress').style.width = progress + '%';
        document.getElementById('loadingText').innerText = progress + '%';

        if (progress === 100) {
          clearInterval(interval);
          document.getElementById("loadingScreen").style.display = 'none'; // Hide loading screen
          alert("Score Confirmed: " + score); // Simulate score confirmation
        }
      }, 500);
    }

    // Show start screen
    document.getElementById("startScreen").style.display = 'block';
  </script>
</body>
</html>

